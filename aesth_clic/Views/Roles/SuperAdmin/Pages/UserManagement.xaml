<Page
  x:Class="aesth_clic.Views.Roles.SuperAdmin.Pages.UserManagement"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:local="using:aesth_clic.Views.Roles.SuperAdmin.Pages"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  mc:Ignorable="d"
  Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
>
  <Page.Resources>
    <Style x:Key="KpiCardStyle" TargetType="Border">
      <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
      <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="8" />
      <Setter Property="Padding" Value="20" />
    </Style>

    <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="13" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}" />
      <Setter Property="CharacterSpacing" Value="50" />
    </Style>

    <Style x:Key="KpiValueStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="28" />
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="Foreground" Value="{ThemeResource TextFillColorPrimaryBrush}" />
    </Style>

    <Style x:Key="KpiLabelStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="13" />
      <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}" />
      <Setter Property="Margin" Value="0,4,0,0" />
    </Style>

    <Style x:Key="ColHeaderStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="12" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}" />
      <Setter Property="CharacterSpacing" Value="50" />
      <Setter Property="VerticalAlignment" Value="Center" />
    </Style>

    <Style x:Key="CellTextStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="13" />
      <Setter Property="Foreground" Value="{ThemeResource TextFillColorPrimaryBrush}" />
      <Setter Property="VerticalAlignment" Value="Center" />
      <Setter Property="TextTrimming" Value="CharacterEllipsis" />
    </Style>

    <Style x:Key="CellSecondaryStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="12" />
      <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}" />
      <Setter Property="VerticalAlignment" Value="Center" />
      <Setter Property="TextTrimming" Value="CharacterEllipsis" />
    </Style>
  </Page.Resources>

  <Grid Padding="24" RowSpacing="20">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- ══════════════════════════════════════
             ROW 0 · Page Header
        ══════════════════════════════════════ -->
    <Grid Grid.Row="0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <StackPanel Grid.Column="0" Spacing="2">
        <TextBlock
          Text="Client Management"
          FontSize="24"
          FontWeight="Bold"
          Foreground="{ThemeResource TextFillColorPrimaryBrush}"
        />
        <TextBlock
          Text="Manage client (admin) accounts"
          FontSize="13"
          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
        />
      </StackPanel>

      <Button
        Grid.Column="1"
        x:Name="AddUserButton"
        Style="{StaticResource AccentButtonStyle}"
        VerticalAlignment="Center"
        Click="AddUserButton_Click"
        Padding="16,8"
      >
        <StackPanel Orientation="Horizontal" Spacing="8">
          <FontIcon Glyph="&#xE710;" FontSize="14" />
          <TextBlock Text="Add Client" />
        </StackPanel>
      </Button>
    </Grid>

    <!-- ══════════════════════════════════════
             ROW 1 · Toast InfoBar
        ══════════════════════════════════════ -->
    <InfoBar Grid.Row="1" x:Name="ToastBar" IsOpen="False" IsClosable="True" Margin="0,-8,0,-8" />

    <!-- ══════════════════════════════════════
             ROW 2 · KPI Summary Cards
        ══════════════════════════════════════ -->
    <Grid Grid.Row="2" ColumnSpacing="16">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>

      <!-- Total Clients -->
      <Border Grid.Column="0" Style="{StaticResource KpiCardStyle}">
        <StackPanel Spacing="4">
          <Grid VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <StackPanel
              Grid.Column="0"
              Orientation="Horizontal"
              Spacing="8"
              VerticalAlignment="Center"
            >
              <FontIcon
                Glyph="&#xE716;"
                FontSize="16"
                Foreground="#0078D4"
                VerticalAlignment="Center"
              />
              <TextBlock
                Text="TOTAL CLIENTS"
                Style="{StaticResource SectionHeaderStyle}"
                VerticalAlignment="Center"
              />
            </StackPanel>
            <TextBlock
              Grid.Column="1"
              x:Name="TxtTotalUsers"
              Text="0"
              FontSize="18"
              FontWeight="SemiBold"
              Foreground="{ThemeResource TextFillColorPrimaryBrush}"
              VerticalAlignment="Center"
            />
          </Grid>
          <TextBlock Text="All registered accounts" Style="{StaticResource KpiLabelStyle}" />
        </StackPanel>
      </Border>

      <!-- Active Clients -->
      <Border Grid.Column="1" Style="{StaticResource KpiCardStyle}">
        <StackPanel Spacing="4">
          <Grid VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <StackPanel
              Grid.Column="0"
              Orientation="Horizontal"
              Spacing="8"
              VerticalAlignment="Center"
            >
              <FontIcon
                Glyph="&#xE8FA;"
                FontSize="16"
                Foreground="#0EA47A"
                VerticalAlignment="Center"
              />
              <TextBlock
                Text="ACTIVE CLIENTS"
                Style="{StaticResource SectionHeaderStyle}"
                VerticalAlignment="Center"
              />
            </StackPanel>
            <TextBlock
              Grid.Column="1"
              x:Name="TxtActiveUsers"
              Text="0"
              FontSize="18"
              FontWeight="SemiBold"
              Foreground="{ThemeResource TextFillColorPrimaryBrush}"
              VerticalAlignment="Center"
            />
          </Grid>
          <TextBlock Text="Currently active accounts" Style="{StaticResource KpiLabelStyle}" />
        </StackPanel>
      </Border>

      <!-- Deactivated Clients -->
      <Border Grid.Column="2" Style="{StaticResource KpiCardStyle}">
        <StackPanel Spacing="4">
          <Grid VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <StackPanel
              Grid.Column="0"
              Orientation="Horizontal"
              Spacing="8"
              VerticalAlignment="Center"
            >
              <FontIcon
                Glyph="&#xEA8C;"
                FontSize="16"
                Foreground="#D83B01"
                VerticalAlignment="Center"
              />
              <TextBlock
                Text="DEACTIVATED CLIENTS"
                Style="{StaticResource SectionHeaderStyle}"
                VerticalAlignment="Center"
              />
            </StackPanel>
            <TextBlock
              Grid.Column="1"
              x:Name="TxtInactiveUsers"
              Text="0"
              FontSize="18"
              FontWeight="SemiBold"
              Foreground="{ThemeResource TextFillColorPrimaryBrush}"
              VerticalAlignment="Center"
            />
          </Grid>
          <TextBlock Text="Deactivated accounts" Style="{StaticResource KpiLabelStyle}" />
        </StackPanel>
      </Border>
    </Grid>

    <!-- ══════════════════════════════════════
             ROW 3 · Search + Filter Toolbar
        ══════════════════════════════════════ -->
    <Grid Grid.Row="3" ColumnSpacing="12">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="260" />
        <ColumnDefinition Width="160" />
        <ColumnDefinition Width="160" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>

      <AutoSuggestBox
        Grid.Column="0"
        x:Name="SearchBox"
        PlaceholderText="Search name, email, or clinic…"
        QueryIcon="Find"
        VerticalAlignment="Center"
        TextChanged="SearchBox_TextChanged"
      />

      <ComboBox
        Grid.Column="1"
        x:Name="StatusFilter"
        PlaceholderText="All Status"
        VerticalAlignment="Center"
        HorizontalAlignment="Stretch"
        SelectionChanged="StatusFilter_SelectionChanged"
      >
        <ComboBoxItem Content="All Status" Tag="All" />
        <ComboBoxItem Content="Active" Tag="Active" />
        <ComboBoxItem Content="Deactivated" Tag="Deactivated" />
      </ComboBox>

      <ComboBox
        Grid.Column="2"
        x:Name="TierFilter"
        PlaceholderText="All Tiers"
        VerticalAlignment="Center"
        HorizontalAlignment="Stretch"
        SelectionChanged="TierFilter_SelectionChanged"
      >
        <ComboBoxItem Content="All Tiers" Tag="All" />
        <ComboBoxItem Content="Basic" Tag="basic" />
        <ComboBoxItem Content="Standard" Tag="standard" />
        <ComboBoxItem Content="Premium" Tag="premium" />
      </ComboBox>
    </Grid>

    <!-- ══════════════════════════════════════
             ROW 4 · Clients Table
        ══════════════════════════════════════ -->
    <Border
      Grid.Row="4"
      Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
      BorderThickness="1"
      CornerRadius="8"
    >
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Column Headers -->
        <Border
          Grid.Row="0"
          Background="{ThemeResource SubtleFillColorSecondaryBrush}"
          CornerRadius="8,8,0,0"
          Padding="20,12"
        >
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="36" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="180" />
              <ColumnDefinition Width="130" />
              <ColumnDefinition Width="160" />
              <ColumnDefinition Width="110" />
              <ColumnDefinition Width="100" />
              <ColumnDefinition Width="60" />
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="#" Style="{StaticResource ColHeaderStyle}" />
            <TextBlock Grid.Column="1" Text="NAME" Style="{StaticResource ColHeaderStyle}" />
            <TextBlock Grid.Column="2" Text="EMAIL" Style="{StaticResource ColHeaderStyle}" />
            <TextBlock Grid.Column="3" Text="PHONE" Style="{StaticResource ColHeaderStyle}" />
            <TextBlock Grid.Column="4" Text="CLINIC NAME" Style="{StaticResource ColHeaderStyle}" />
            <TextBlock Grid.Column="5" Text="TIER" Style="{StaticResource ColHeaderStyle}" />
            <TextBlock Grid.Column="6" Text="STATUS" Style="{StaticResource ColHeaderStyle}" />
            <TextBlock
              Grid.Column="7"
              Text="ACTIONS"
              Style="{StaticResource ColHeaderStyle}"
              HorizontalAlignment="Center"
            />
          </Grid>
        </Border>

        <!-- Scrollable Client Rows -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
          <ItemsControl x:Name="UserListControl">
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="local:UserItem">
                <Border
                  BorderThickness="0,0,0,1"
                  BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                  Padding="20,0"
                >
                  <Grid MinHeight="52">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="36" />
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="180" />
                      <ColumnDefinition Width="130" />
                      <ColumnDefinition Width="160" />
                      <ColumnDefinition Width="110" />
                      <ColumnDefinition Width="100" />
                      <ColumnDefinition Width="60" />
                    </Grid.ColumnDefinitions>

                    <!-- # -->
                    <TextBlock
                      Grid.Column="0"
                      Text="{x:Bind RowNumber}"
                      Style="{StaticResource CellSecondaryStyle}"
                    />

                    <!-- NAME + Avatar -->
                    <StackPanel
                      Grid.Column="1"
                      Orientation="Horizontal"
                      Spacing="10"
                      VerticalAlignment="Center"
                    >
                      <Border
                        Width="32"
                        Height="32"
                        CornerRadius="16"
                        Background="{x:Bind AvatarColor}"
                      >
                        <TextBlock
                          Text="{x:Bind Initials}"
                          FontSize="13"
                          FontWeight="SemiBold"
                          Foreground="White"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                        />
                      </Border>
                      <TextBlock
                        Text="{x:Bind FullName}"
                        Style="{StaticResource CellTextStyle}"
                        FontWeight="SemiBold"
                      />
                    </StackPanel>

                    <!-- EMAIL -->
                    <TextBlock
                      Grid.Column="2"
                      Text="{x:Bind Email}"
                      Style="{StaticResource CellSecondaryStyle}"
                    />

                    <!-- PHONE -->
                    <TextBlock
                      Grid.Column="3"
                      Text="{x:Bind Phone}"
                      Style="{StaticResource CellSecondaryStyle}"
                    />

                    <!-- CLINIC NAME -->
                    <StackPanel
                      Grid.Column="4"
                      Orientation="Horizontal"
                      Spacing="6"
                      VerticalAlignment="Center"
                    >
                      <FontIcon
                        Glyph="&#xE825;"
                        FontSize="12"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        VerticalAlignment="Center"
                      />
                      <TextBlock
                        Text="{x:Bind ClinicName}"
                        Style="{StaticResource CellSecondaryStyle}"
                      />
                    </StackPanel>

                    <!-- TIER -->
                    <TextBlock
                      Grid.Column="5"
                      Text="{x:Bind TierDisplay}"
                      FontSize="11"
                      FontWeight="SemiBold"
                      Foreground="{x:Bind TierBadgeText}"
                      VerticalAlignment="Center"
                    />

                    <!-- STATUS -->
                    <TextBlock
                      Grid.Column="6"
                      Text="{x:Bind Status}"
                      FontSize="11"
                      FontWeight="SemiBold"
                      Foreground="{x:Bind StatusBadgeText}"
                      VerticalAlignment="Center"
                    />

                    <!-- ACTIONS -->
                    <Button
                      Grid.Column="7"
                      Tag="{x:Bind UserId}"
                      Click="KebabMenu_Click"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Padding="8,4"
                      ToolTipService.ToolTip="More actions"
                      Style="{StaticResource SubtleButtonStyle}"
                    >
                      <FontIcon Glyph="&#xE712;" FontSize="16" />
                      <Button.Flyout>
                        <MenuFlyout Placement="BottomEdgeAlignedRight">
                          <MenuFlyoutItem Text="Edit" Tag="{x:Bind UserId}" Click="EditUser_Click">
                            <MenuFlyoutItem.Icon>
                              <FontIcon Glyph="&#xE70F;" />
                            </MenuFlyoutItem.Icon>
                          </MenuFlyoutItem>

                          <MenuFlyoutItem
                            Text="Manage Modules"
                            Tag="{x:Bind UserId}"
                            Click="ManageModules_Click"
                          >
                            <MenuFlyoutItem.Icon>
                              <FontIcon Glyph="&#xEA37;" />
                            </MenuFlyoutItem.Icon>
                          </MenuFlyoutItem>

                          <MenuFlyoutSeparator />

                          <MenuFlyoutItem
                            Text="Deactivate"
                            Tag="{x:Bind UserId}"
                            Visibility="{x:Bind DeactivateVisible}"
                            Click="DeactivateUser_Click"
                          >
                            <MenuFlyoutItem.Icon>
                              <FontIcon Glyph="&#xEA8C;" Foreground="#D83B01" />
                            </MenuFlyoutItem.Icon>
                            <MenuFlyoutItem.Foreground>
                              <SolidColorBrush Color="#D83B01" />
                            </MenuFlyoutItem.Foreground>
                          </MenuFlyoutItem>

                          <MenuFlyoutItem
                            Text="Reactivate"
                            Tag="{x:Bind UserId}"
                            Visibility="{x:Bind ReactivateVisible}"
                            Click="ReactivateUser_Click"
                          >
                            <MenuFlyoutItem.Icon>
                              <FontIcon Glyph="&#xE72C;" Foreground="#0EA47A" />
                            </MenuFlyoutItem.Icon>
                            <MenuFlyoutItem.Foreground>
                              <SolidColorBrush Color="#0EA47A" />
                            </MenuFlyoutItem.Foreground>
                          </MenuFlyoutItem>

                          <MenuFlyoutItem
                            Text="Delete"
                            Tag="{x:Bind UserId}"
                            Visibility="{x:Bind DeleteVisible}"
                            Click="DeleteUser_Click"
                          >
                            <MenuFlyoutItem.Icon>
                              <FontIcon Glyph="&#xE74D;" Foreground="#C50F1F" />
                            </MenuFlyoutItem.Icon>
                            <MenuFlyoutItem.Foreground>
                              <SolidColorBrush Color="#C50F1F" />
                            </MenuFlyoutItem.Foreground>
                          </MenuFlyoutItem>
                        </MenuFlyout>
                      </Button.Flyout>
                    </Button>
                  </Grid>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>

        <!-- Footer -->
        <Border
          Grid.Row="2"
          Background="{ThemeResource SubtleFillColorSecondaryBrush}"
          CornerRadius="0,0,8,8"
          Padding="20,10"
        >
          <TextBlock
            x:Name="TxtRowCount"
            Text="Showing 0 clients"
            FontSize="12"
            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
          />
        </Border>
      </Grid>
    </Border>
  </Grid>
</Page>
