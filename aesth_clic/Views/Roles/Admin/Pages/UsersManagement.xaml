<Page
  x:Class="aesth_clic.Views.Roles.Admin.Pages.UserManagement"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:local="using:aesth_clic.Views.Roles.Admin.Pages"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  mc:Ignorable="d"
  Background="#F7F4FD"
>
  <Page.Resources>
    <local:StringToBrushConverter x:Key="StringToBrush" />
    <local:StringToVisibilityConverter x:Key="StringToVisibility" />

    <Style x:Key="CardStyle" TargetType="Border">
      <Setter Property="Background" Value="White" />
      <Setter Property="BorderBrush" Value="#E4DAF5" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="12" />
      <Setter Property="Padding" Value="20" />
    </Style>

    <Style x:Key="KpiValueStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="30" />
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="Foreground" Value="#2D1554" />
    </Style>

    <Style x:Key="KpiLabelStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="11" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="Foreground" Value="#9B80C4" />
      <Setter Property="CharacterSpacing" Value="50" />
    </Style>

    <Style x:Key="KpiSubStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="12" />
      <Setter Property="Foreground" Value="#B0A0CC" />
      <Setter Property="Margin" Value="0,3,0,0" />
    </Style>

    <Style x:Key="ColHeaderStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="10" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="Foreground" Value="#9B80C4" />
      <Setter Property="CharacterSpacing" Value="50" />
      <Setter Property="VerticalAlignment" Value="Center" />
    </Style>

    <Style x:Key="CellTextStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="13" />
      <Setter Property="Foreground" Value="#2D1554" />
      <Setter Property="VerticalAlignment" Value="Center" />
      <Setter Property="TextTrimming" Value="CharacterEllipsis" />
    </Style>

    <Style x:Key="CellSecondaryStyle" TargetType="TextBlock">
      <Setter Property="FontSize" Value="12" />
      <Setter Property="Foreground" Value="#9B80C4" />
      <Setter Property="VerticalAlignment" Value="Center" />
      <Setter Property="TextTrimming" Value="CharacterEllipsis" />
    </Style>
  </Page.Resources>

  <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
    <Grid Padding="28,24,28,32" RowSpacing="20">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <!-- ROW 0 · Page Header -->
      <Grid Grid.Row="0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Spacing="2">
          <TextBlock Text="User Management" FontSize="26" FontWeight="Bold" Foreground="#2D1554" />
          <TextBlock
            Text="Manage clinic staff — Doctors, Receptionists, and Pharmacists"
            FontSize="13"
            Foreground="#9B80C4"
          />
        </StackPanel>

        <Button
          Grid.Column="1"
          x:Name="AddUserButton"
          VerticalAlignment="Center"
          Click="AddUserButton_Click"
          Padding="16,10"
          Background="#5B2D8E"
          CornerRadius="8"
          BorderThickness="0"
        >
          <StackPanel Orientation="Horizontal" Spacing="8">
            <FontIcon Glyph="&#xE710;" FontSize="13" Foreground="White" />
            <TextBlock Text="Add User" Foreground="White" FontWeight="SemiBold" FontSize="13" />
          </StackPanel>
        </Button>
      </Grid>

      <!-- ROW 1 · Toast InfoBar -->
      <InfoBar Grid.Row="1" x:Name="ToastBar" IsOpen="False" IsClosable="True" Margin="0,-8,0,-8" />

      <!-- ROW 2 · KPI Cards -->
      <Grid Grid.Row="2" ColumnSpacing="16">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Total -->
        <Border Grid.Column="0" Style="{StaticResource CardStyle}">
          <StackPanel Spacing="4">
            <Grid VerticalAlignment="Center">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <StackPanel
                Grid.Column="0"
                Orientation="Horizontal"
                Spacing="10"
                VerticalAlignment="Center"
              >
                <Border Width="36" Height="36" CornerRadius="8" Background="#EDE4F9">
                  <FontIcon Glyph="&#xE716;" FontSize="16" Foreground="#5B2D8E" />
                </Border>
                <TextBlock
                  Text="TOTAL USERS"
                  Style="{StaticResource KpiLabelStyle}"
                  VerticalAlignment="Center"
                />
              </StackPanel>
              <TextBlock
                Grid.Column="1"
                x:Name="TxtTotalUsers"
                Text="0"
                FontSize="18"
                FontWeight="SemiBold"
                Foreground="#2D1554"
                VerticalAlignment="Center"
              />
            </Grid>
            <TextBlock Text="All registered staff accounts" Style="{StaticResource KpiSubStyle}" />
          </StackPanel>
        </Border>

        <!-- Active -->
        <Border Grid.Column="1" Style="{StaticResource CardStyle}">
          <StackPanel Spacing="4">
            <Grid VerticalAlignment="Center">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <StackPanel
                Grid.Column="0"
                Orientation="Horizontal"
                Spacing="10"
                VerticalAlignment="Center"
              >
                <Border Width="36" Height="36" CornerRadius="8" Background="#E6F9F2">
                  <FontIcon Glyph="&#xE8FA;" FontSize="16" Foreground="#0EA47A" />
                </Border>
                <TextBlock
                  Text="ACTIVE USERS"
                  Style="{StaticResource KpiLabelStyle}"
                  VerticalAlignment="Center"
                />
              </StackPanel>
              <TextBlock
                Grid.Column="1"
                x:Name="TxtActiveUsers"
                Text="0"
                FontSize="18"
                FontWeight="SemiBold"
                Foreground="#2D1554"
                VerticalAlignment="Center"
              />
            </Grid>
            <TextBlock Text="Currently active accounts" Style="{StaticResource KpiSubStyle}" />
          </StackPanel>
        </Border>

        <!-- Deactivated -->
        <Border Grid.Column="2" Style="{StaticResource CardStyle}">
          <StackPanel Spacing="4">
            <Grid VerticalAlignment="Center">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <StackPanel
                Grid.Column="0"
                Orientation="Horizontal"
                Spacing="10"
                VerticalAlignment="Center"
              >
                <Border Width="36" Height="36" CornerRadius="8" Background="#FDECEA">
                  <FontIcon Glyph="&#xEA8C;" FontSize="16" Foreground="#C0392B" />
                </Border>
                <TextBlock
                  Text="INACTIVE USERS"
                  Style="{StaticResource KpiLabelStyle}"
                  VerticalAlignment="Center"
                />
              </StackPanel>
              <TextBlock
                Grid.Column="1"
                x:Name="TxtInactiveUsers"
                Text="0"
                FontSize="18"
                FontWeight="SemiBold"
                Foreground="#2D1554"
                VerticalAlignment="Center"
              />
            </Grid>
            <TextBlock Text="Deactivated accounts" Style="{StaticResource KpiSubStyle}" />
          </StackPanel>
        </Border>
      </Grid>

      <!-- ROW 3 · Search + Filter Toolbar -->
      <Border
        Grid.Row="3"
        Background="White"
        BorderBrush="#E4DAF5"
        BorderThickness="1"
        CornerRadius="12"
        Padding="16,12"
      >
        <Grid ColumnSpacing="12">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="180" />
            <ColumnDefinition Width="160" />
          </Grid.ColumnDefinitions>

          <AutoSuggestBox
            Grid.Column="0"
            x:Name="SearchBox"
            PlaceholderText="Search name, email, or phone…"
            QueryIcon="Find"
            VerticalAlignment="Center"
            Background="White"
            Foreground="#2D1554"
            BorderBrush="#C4B0E0"
            BorderThickness="1"
            CornerRadius="8"
            TextChanged="SearchBox_TextChanged"
          >
            <AutoSuggestBox.Resources>
              <SolidColorBrush x:Key="TextControlPlaceholderForeground" Color="#9B80C4" />
              <SolidColorBrush x:Key="TextControlPlaceholderForegroundFocused" Color="#9B80C4" />
              <SolidColorBrush
                x:Key="TextControlPlaceholderForegroundPointerOver"
                Color="#9B80C4"
              />

              <!-- Keep border visible on hover/focus -->
              <SolidColorBrush x:Key="TextControlBorderBrush" Color="#C4B0E0" />
              <SolidColorBrush x:Key="TextControlBorderBrushPointerOver" Color="#5B2D8E" />
              <SolidColorBrush x:Key="TextControlBorderBrushFocused" Color="#5B2D8E" />

              <!-- Keep background white on hover/focus -->
              <SolidColorBrush x:Key="TextControlBackground" Color="White" />
              <SolidColorBrush x:Key="TextControlBackgroundPointerOver" Color="White" />
              <SolidColorBrush x:Key="TextControlBackgroundFocused" Color="White" />
            </AutoSuggestBox.Resources>
          </AutoSuggestBox>

          <ComboBox
            Grid.Column="1"
            x:Name="RoleFilter"
            PlaceholderText="All Roles"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Center"
            Background="White"
            Foreground="#2D1554"
            BorderBrush="#C4B0E0"
            BorderThickness="1"
            CornerRadius="8"
            SelectionChanged="RoleFilter_SelectionChanged"
          >
            <ComboBox.Resources>
              <!-- Placeholder text -->
              <SolidColorBrush x:Key="ComboBoxPlaceholderForeground" Color="#9B80C4" />

              <!-- Keep border on all states -->
              <SolidColorBrush x:Key="ComboBoxBorderBrush" Color="#C4B0E0" />
              <SolidColorBrush x:Key="ComboBoxBorderBrushPointerOver" Color="#5B2D8E" />
              <SolidColorBrush x:Key="ComboBoxBorderBrushFocused" Color="#5B2D8E" />
              <SolidColorBrush x:Key="ComboBoxBorderBrushPressed" Color="#5B2D8E" />

              <!-- Keep background white on all states -->
              <SolidColorBrush x:Key="ComboBoxBackground" Color="White" />
              <SolidColorBrush x:Key="ComboBoxBackgroundPointerOver" Color="White" />
              <SolidColorBrush x:Key="ComboBoxBackgroundFocused" Color="White" />
              <SolidColorBrush x:Key="ComboBoxBackgroundPressed" Color="White" />

              <!-- Keep foreground visible on all states -->
              <SolidColorBrush x:Key="ComboBoxForeground" Color="#2D1554" />
              <SolidColorBrush x:Key="ComboBoxForegroundPointerOver" Color="#2D1554" />
              <SolidColorBrush x:Key="ComboBoxForegroundFocused" Color="#2D1554" />
              <SolidColorBrush x:Key="ComboBoxForegroundPressed" Color="#2D1554" />
            </ComboBox.Resources>
            <ComboBoxItem Content="All Roles" Tag="All" IsSelected="True" />
            <ComboBoxItem Content="Doctor" Tag="Doctor" />
            <ComboBoxItem Content="Receptionist" Tag="Receptionist" />
            <ComboBoxItem Content="Pharmacist" Tag="Pharmacist" />
          </ComboBox>

          <ComboBox
            Grid.Column="2"
            x:Name="StatusFilter"
            PlaceholderText="All Status"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Center"
            Background="White"
            Foreground="#2D1554"
            BorderBrush="#C4B0E0"
            BorderThickness="1"
            CornerRadius="8"
            SelectionChanged="StatusFilter_SelectionChanged"
          >
            <ComboBox.Resources>
              <SolidColorBrush x:Key="ComboBoxPlaceholderForeground" Color="#9B80C4" />
              <SolidColorBrush x:Key="ComboBoxBorderBrush" Color="#C4B0E0" />
              <SolidColorBrush x:Key="ComboBoxBorderBrushPointerOver" Color="#5B2D8E" />
              <SolidColorBrush x:Key="ComboBoxBorderBrushFocused" Color="#5B2D8E" />
              <SolidColorBrush x:Key="ComboBoxBorderBrushPressed" Color="#5B2D8E" />
              <SolidColorBrush x:Key="ComboBoxBackground" Color="White" />
              <SolidColorBrush x:Key="ComboBoxBackgroundPointerOver" Color="White" />
              <SolidColorBrush x:Key="ComboBoxBackgroundFocused" Color="White" />
              <SolidColorBrush x:Key="ComboBoxBackgroundPressed" Color="White" />
              <SolidColorBrush x:Key="ComboBoxForeground" Color="#2D1554" />
              <SolidColorBrush x:Key="ComboBoxForegroundPointerOver" Color="#2D1554" />
              <SolidColorBrush x:Key="ComboBoxForegroundFocused" Color="#2D1554" />
              <SolidColorBrush x:Key="ComboBoxForegroundPressed" Color="#2D1554" />
            </ComboBox.Resources>
            <ComboBoxItem Content="All Status" Tag="All" IsSelected="True" />
            <ComboBoxItem Content="Active" Tag="Active" />
            <ComboBoxItem Content="Deactivated" Tag="Deactivated" />
          </ComboBox>
        </Grid>
      </Border>

      <!-- ROW 4 · Users Table -->
      <Border
        Grid.Row="4"
        Background="White"
        BorderBrush="#E4DAF5"
        BorderThickness="1"
        CornerRadius="12"
        Padding="0"
      >
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>

          <!-- Card Header -->
          <Grid Grid.Row="0" Padding="20,16,20,12">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="0" Spacing="2">
              <TextBlock
                Text="Staff Accounts"
                FontSize="15"
                FontWeight="SemiBold"
                Foreground="#2D1554"
              />
              <TextBlock Text="All registered clinic staff" FontSize="12" Foreground="#9B80C4" />
            </StackPanel>
            <TextBlock
              Grid.Column="1"
              x:Name="TxtRowCount"
              Text="Showing 0 users"
              FontSize="12"
              Foreground="#5B2D8E"
              FontWeight="SemiBold"
              VerticalAlignment="Center"
            />
          </Grid>

          <!-- Column Headers -->
          <Grid Grid.Row="1">
            <Border Background="#F7F4FD" Padding="20,9">
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="200" />
                  <ColumnDefinition Width="140" />
                  <ColumnDefinition Width="120" />
                  <ColumnDefinition Width="90" />
                  <ColumnDefinition Width="60" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="NAME" Style="{StaticResource ColHeaderStyle}" />
                <TextBlock Grid.Column="1" Text="EMAIL" Style="{StaticResource ColHeaderStyle}" />
                <TextBlock Grid.Column="2" Text="PHONE" Style="{StaticResource ColHeaderStyle}" />
                <TextBlock Grid.Column="3" Text="ROLE" Style="{StaticResource ColHeaderStyle}" />
                <TextBlock Grid.Column="4" Text="STATUS" Style="{StaticResource ColHeaderStyle}" />
                <TextBlock
                  Grid.Column="5"
                  Text="ACTIONS"
                  Style="{StaticResource ColHeaderStyle}"
                  HorizontalAlignment="Center"
                />
              </Grid>
            </Border>
            <Border Height="1" Background="#E4DAF5" VerticalAlignment="Bottom" />
          </Grid>

          <!-- Data Rows -->
          <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" MaxHeight="480">
            <ItemsControl x:Name="UserListControl">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="local:StaffUserItem">
                  <StackPanel>
                    <Border Padding="20,0">
                      <Grid MinHeight="60">
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="*" />
                          <ColumnDefinition Width="200" />
                          <ColumnDefinition Width="140" />
                          <ColumnDefinition Width="120" />
                          <ColumnDefinition Width="90" />
                          <ColumnDefinition Width="60" />
                        </Grid.ColumnDefinitions>

                        <!-- Name + Avatar -->
                        <StackPanel
                          Grid.Column="0"
                          Orientation="Horizontal"
                          Spacing="10"
                          VerticalAlignment="Center"
                        >
                          <Border
                            Width="36"
                            Height="36"
                            CornerRadius="18"
                            Background="{Binding AvatarColor, Converter={StaticResource StringToBrush}}"
                          >
                            <TextBlock
                              Text="{x:Bind Initials}"
                              FontSize="13"
                              FontWeight="SemiBold"
                              Foreground="White"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                            />
                          </Border>
                          <TextBlock
                            Text="{x:Bind FullName}"
                            Style="{StaticResource CellTextStyle}"
                            FontWeight="SemiBold"
                          />
                        </StackPanel>

                        <!-- Email -->
                        <TextBlock
                          Grid.Column="1"
                          Text="{x:Bind Email}"
                          Style="{StaticResource CellSecondaryStyle}"
                        />

                        <!-- Phone -->
                        <TextBlock
                          Grid.Column="2"
                          Text="{x:Bind Phone}"
                          Style="{StaticResource CellSecondaryStyle}"
                        />

                        <!-- Role -->
                        <TextBlock
                          Grid.Column="3"
                          Text="{x:Bind Role}"
                          FontSize="12"
                          FontWeight="SemiBold"
                          Foreground="{Binding RoleBadgeText, Converter={StaticResource StringToBrush}}"
                          VerticalAlignment="Center"
                        />

                        <!-- Status -->
                        <StackPanel
                          Grid.Column="4"
                          Orientation="Horizontal"
                          Spacing="5"
                          VerticalAlignment="Center"
                        >
                          <Ellipse
                            Width="7"
                            Height="7"
                            Fill="{Binding StatusBadgeText, Converter={StaticResource StringToBrush}}"
                          />
                          <TextBlock
                            Text="{x:Bind Status}"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="{Binding StatusBadgeText, Converter={StaticResource StringToBrush}}"
                            VerticalAlignment="Center"
                          />
                        </StackPanel>

                        <!-- Actions · Kebab Menu -->
                        <Border
                          Grid.Column="5"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                        >
                          <Button
                            Padding="6,4"
                            Background="Transparent"
                            CornerRadius="6"
                            BorderThickness="0"
                            ToolTipService.ToolTip="More actions"
                          >
                            <Button.Flyout>
                              <MenuFlyout Placement="BottomEdgeAlignedRight">
                                <MenuFlyoutItem
                                  Tag="{x:Bind UserId}"
                                  Text="Edit"
                                  Click="EditUser_Click"
                                >
                                  <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE70F;" FontSize="13" />
                                  </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                                <MenuFlyoutItem
                                  Tag="{x:Bind UserId}"
                                  Text="Deactivate"
                                  Click="DeactivateUser_Click"
                                  Visibility="{Binding DeactivateVisible, Converter={StaticResource StringToVisibility}}"
                                >
                                  <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xEA8C;" FontSize="13" />
                                  </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                                <MenuFlyoutItem
                                  Tag="{x:Bind UserId}"
                                  Text="Reactivate"
                                  Click="ReactivateUser_Click"
                                  Visibility="{Binding ReactivateVisible, Converter={StaticResource StringToVisibility}}"
                                >
                                  <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE8FB;" FontSize="13" />
                                  </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                                <MenuFlyoutSeparator Visibility="{Binding DeleteVisible, Converter={StaticResource StringToVisibility}}" />

                                <MenuFlyoutItem
                                  Tag="{x:Bind UserId}"
                                  Text="Delete"
                                  Click="DeleteUser_Click"
                                  Visibility="{Binding DeleteVisible, Converter={StaticResource StringToVisibility}}"
                                >
                                  <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE74D;" FontSize="13" />
                                  </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                              </MenuFlyout>
                            </Button.Flyout>

                            <FontIcon Glyph="&#xE712;" FontSize="16" Foreground="#5B2D8E" />
                          </Button>
                        </Border>
                      </Grid>
                    </Border>
                    <Border Height="1" Background="#F0EAF8" Margin="20,0" />
                  </StackPanel>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
        </Grid>
      </Border>
    </Grid>
  </ScrollViewer>
</Page>
